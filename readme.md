## 서울생활인구

👉 [프로젝트 바로가기](https://hanbyul-here.github.io/seoul-population-by-time/)

👉 데이터 출처: [서울열린데이터광장/서울생활인구](http://data.seoul.go.kr/dataVisual/seoul/seoulLivingPopulation.do) 

서울생활인구 프로젝트는 2018년 8월 27일부터 2018년 9월 2일까지 서울 특정지역, 특정시간에 존재한 인구(생활인구)를 행정구역별로 정리하여 웹지도 형태로 보여줍니다.


### 프로젝트의 시작

맨하탄 유동 인구를 시각화한 [Manhattan Population Explorer](http://manpopex.us/) 프로젝트의 움짤을 본 것이 이 프로젝트를 시작하게 된 첫 계기였습니다. 애니메이션이 데이터의 특성을 잘 표현하는 케이스였고, 시간의 흐름대로 인구의 이동량을 볼 수 있는 움짤이 주는 직관성을 웹 인터페이스를 통해 구현할 수 있으면 좋겠다는 생각이 들었습니다. 전 사실 데이터를 보이는대로 북마크해놓고 쓸 데는 나중에 생각하자는 식의 데이타 호더러인데, 서울 유동인구 관련 데이터가 어디엔가 있었는데... 뭐였더라 하고 의식의 흐름을 따라따라 되짚어 보니 [서울의 생활인구 데이터 개방 관련](https://twitter.com/beingsince/status/969746505132228608) 소식을 트위터에서 들었던 기억이 났습니다. 

💡 그래 이 데이터를 써야겠어! 💡

### 개발일지

처음 프로젝트를 시작했을 떄 계획한 단계는 다음과 같았습니다.

- 서울 행정구 셰이프 데이터를 이용해서 각 구의 중간점에 위치한 육각형을 딴다.
- 일주일치 생활인구 데이터를 시간대별로 파싱해서 각 행정구의 속성으로 넘긴다.
- 브라우저내 스크립트로 시간을 업데이트하고 애니메이션을 구현한다.

이렇게 프로젝트의 얼개를 만들어놓고 보니, 문제가 있었으니... *느려!!* 전반적으로 애니메이션이 느린데다가, 지도가 줌아웃된 상황에서 한 번에 많은 행정구들의 데이터 (바그래프)를 업데이트해야할 때와 (느림) 줌인한 상황에서 한 두개 구의 데이터를 업데이트해야할 때의 애니메이션 속도가 (비교적 덜 느림) 크게 차이가 났습니다.

후후 하지만 저는 이 문제를 막연히 예상하고 있었습니다. 이번 프로젝트에 사용한 지도 렌더링 엔진인 탠그램을 자주 사용하는 편인데, 변수를 업데이트하고 그걸 렌더링 엔진에게 패스한 후 렌더링 엔진이 신을 다시 빌딩하기까지 시간을 기다리자면 일회성 이벤트 (버튼 등의  UI 이벤트에 따라 다른 데이터를 보여주거나 색상등의 속성 업데이트) 에 반응하긴 나쁘지 않지만 순차적인 애니메이션을 만들기는 적합하지 않을 것이란느 예감이 있었고 그 예감은 딱 들어맞았습니다.. 그래서 기억을 더듬고 더듬어 전동료 Patricio가 빠른 애니메이션을 구현하기 위해 보여줬던 프로젝트를 찾아냅니다. 

- [Weather Over Time](https://github.com/tangrams/WeatherOverTime/) by Patricio Gonzalez Vivo

Weather Over Time은 기상청 데이터에 기반하여 한 달 간의 기온, 풍향, 풍속을 시각화한 프로젝트인데 서울생활인구 프로젝트를 만드는 데 필요했던 부분을 거칠게 요약하자면 다음과 같습니다.

- 데이터를 파싱하여 PNG 이미지로 옮긴다. (Weather Over Time의 경우 기온을 R channel, 풍향을  G channel, 풍속을 B channel로 옮겼습니다.)
- 데이터가 인코딩된 이미지를 해당 레이어의 셰이더에 텍스쳐로 패스한다. 
- 브라우저내 스크립트는 셰이더 텍스처의 인덱스를 업데이트한다. 



🦄 왜 셰이더를 사용하면 퍼포먼스가 눈에 띄게 개선되는지 궁금하시다면 : 프로젝트의 메인 저자인  Patrico Gonzalez Vivo가 작성한 [Book of Shader](https://thebookofshaders.com/01/)의 1 챕터를 읽어보세요!

데이터 인코딩 과정을 좀 더 자세히 기록하자면 다음과 같습니다. 

가로 * 세로 (Python code snippet과 결과 이미지)


![생활인구 데이터 텍스쳐](https://raw.githubusercontent.com/hanbyul-here/seoul-population-by-time/master/data/20180827/total.png)

![주거인구 데이터 텍스쳐](https://raw.githubusercontent.com/hanbyul-here/seoul-population-by-time/master/data/residents.png)


### 자세히 보아야 예쁘다.


